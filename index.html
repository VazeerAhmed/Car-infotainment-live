<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AutoVerse | In-Car Entertainment System</title>
    
    <!-- Favicon - AutoVerse Logo -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%2300d9ff'/><stop offset='100%25' style='stop-color:%237c3aed'/></linearGradient></defs><rect fill='url(%23grad)' width='100' height='100' rx='20'/><text x='50' y='72' font-size='65' text-anchor='middle' fill='white' font-family='Arial, sans-serif' font-weight='bold'>A</text></svg>">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
    <script>
        // API Configuration (inline to avoid external file issues on GitHub Pages)
        const API_CONFIG = {
            WEATHER_API_KEY: '90c270e247e81a5e90af75efac65d4f7',
            WEATHER_CITY: 'auto',
            GOOGLE_MAPS_API_KEY: '',
            FAVORITE_DESTINATIONS: []
        };
    </script>
    <style>
        :root {
            --bg: #000000;
            --card-bg: #0a0a0a;
            --glass: rgba(255, 255, 255, 0.05);
            --accent: #00d9ff;
            --accent-secondary: #7c3aed;
            --border: rgba(255, 255, 255, 0.1);
            --glow: rgba(0, 217, 255, 0.4);
            --text: #ffffff;
            --text-dim: #9ca3af;
            --danger: #ef4444;
            --success: #10b981;
        }

        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body { 
            background: var(--bg);
            color: var(--text); 
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            position: relative;
        }

        /* Ambient background */
        .ambient-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 50%, rgba(0, 217, 255, 0.08) 0%, transparent 50%),
                        radial-gradient(circle at 80% 50%, rgba(124, 58, 237, 0.08) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        /* Main container */
        .car-system {
            position: relative;
            z-index: 1;
            display: grid;
            grid-template-rows: 80px 1fr 100px;
            height: 100vh;
            padding: 0;
        }

        /* Top status bar */
        .status-bar {
            background: var(--card-bg);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 40px;
        }

        .status-left {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .vehicle-info h2 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .vehicle-info p {
            font-size: 0.75rem;
            color: var(--text-dim);
        }

        .status-right {
            display: flex;
            align-items: center;
            gap: 25px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--text-dim);
        }

        .status-item i {
            color: var(--accent);
            font-size: 1.1rem;
        }

        /* Main content area */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 0;
            overflow: hidden;
        }

        .content-area {
            padding: 30px;
            overflow-y: auto;
            position: relative;
        }

        /* View sections */
        .view {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .view.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Entertainment Grid */
        .entertainment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .ent-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .ent-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-secondary) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .ent-card:hover {
            border-color: var(--accent);
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 217, 255, 0.2);
        }

        .ent-card:hover::before {
            opacity: 0.1;
        }

        .ent-card i {
            font-size: 3.5rem;
            color: var(--accent);
            margin-bottom: 15px;
            display: block;
            position: relative;
            z-index: 1;
            filter: drop-shadow(0 0 15px var(--glow));
        }

        .ent-card h3 {
            font-size: 1.2rem;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }

        .ent-card p {
            font-size: 0.85rem;
            color: var(--text-dim);
            position: relative;
            z-index: 1;
        }

        .ent-card .live-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--success);
            color: white;
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 0.65rem;
            font-weight: bold;
            z-index: 2;
            animation: pulse 2s infinite;
        }

        /* Iframe container for embedded apps */
        .iframe-container {
            width: 100%;
            height: calc(100vh - 280px);
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 24px;
            overflow: hidden;
            position: relative;
        }

        .iframe-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .iframe-header {
            background: var(--glass);
            border-bottom: 1px solid var(--border);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .iframe-controls {
            display: flex;
            gap: 10px;
        }

        .iframe-btn {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: var(--glass);
            border: 1px solid var(--border);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .iframe-btn:hover {
            background: var(--accent);
            border-color: var(--accent);
        }

        /* Loading spinner */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            color: var(--accent);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* Right Sidebar */
        .sidebar {
            background: var(--card-bg);
            border-left: 1px solid var(--border);
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
        }

        .sidebar-section {
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 20px;
        }

        .sidebar-section h4 {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-dim);
            margin-bottom: 15px;
        }

        /* Climate Control */
        .climate-display {
            text-align: center;
            margin: 20px 0;
        }

        .temp-value {
            font-size: 3.5rem;
            font-weight: 200;
            color: var(--accent);
            line-height: 1;
        }

        .temp-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }

        .temp-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--glass);
            border: 1px solid var(--border);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .temp-btn:hover {
            background: var(--accent);
            border-color: var(--accent);
            transform: scale(1.1);
        }

        /* Trip Info */
        .trip-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .stat-box {
            text-align: center;
            padding: 15px;
            background: var(--glass);
            border-radius: 12px;
        }

        .stat-box .value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--accent);
            display: block;
            margin-bottom: 5px;
        }

        .stat-box .label {
            font-size: 0.75rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Navigation Preview */
        .nav-preview {
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .nav-direction {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .nav-icon {
            width: 50px;
            height: 50px;
            background: var(--accent);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .nav-text h4 {
            font-size: 1rem;
            margin-bottom: 3px;
        }

        .nav-text p {
            font-size: 0.8rem;
            color: var(--text-dim);
        }

        /* Bottom Navigation */
        .bottom-nav {
            background: var(--card-bg);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 40px;
        }

        .nav-btn {
            flex: 1;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            color: var(--text-dim);
            transition: all 0.3s ease;
            border: none;
            background: transparent;
            position: relative;
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--accent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .nav-btn.active {
            color: var(--accent);
        }

        .nav-btn.active::before {
            opacity: 1;
        }

        .nav-btn i {
            font-size: 1.8rem;
        }

        .nav-btn span {
            font-size: 0.75rem;
            font-weight: 500;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .status-bar {
                padding: 0 15px;
                grid-template-rows: 70px 1fr 80px;
            }

            .status-left {
                gap: 15px;
            }

            .vehicle-info h2 {
                font-size: 1.2rem;
            }

            .stat-item {
                font-size: 0.8rem;
            }

            .bottom-nav {
                padding: 0 10px;
                display: grid;
                grid-template-columns: repeat(6, 1fr);
            }

            .nav-btn {
                padding: 10px 5px;
            }

            .nav-btn i {
                font-size: 1.5rem;
            }

            .nav-btn span {
                font-size: 0.65rem;
            }

            .sidebar {
                display: none;
            }

            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* Games Grid */
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
        }

        .game-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .game-card:hover {
            border-color: var(--accent);
            transform: translateY(-5px);
        }

        .game-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 15px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-secondary) 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        /* Settings */
        .settings-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 16px;
        }

        .setting-info h4 {
            font-size: 1rem;
            margin-bottom: 5px;
        }

        .setting-info p {
            font-size: 0.8rem;
            color: var(--text-dim);
        }

        .toggle {
            width: 50px;
            height: 26px;
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 13px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle.active {
            background: var(--accent);
            border-color: var(--accent);
        }

        .toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .toggle.active::after {
            left: 26px;
        }

        /* Scrollbar */
        .content-area::-webkit-scrollbar,
        .sidebar::-webkit-scrollbar {
            width: 8px;
        }

        .content-area::-webkit-scrollbar-track,
        .sidebar::-webkit-scrollbar-track {
            background: var(--glass);
        }

        .content-area::-webkit-scrollbar-thumb,
        .sidebar::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        .content-area::-webkit-scrollbar-thumb:hover,
        .sidebar::-webkit-scrollbar-thumb:hover {
            background: var(--accent);
        }

        /* Fullscreen mode */
        .fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 9999;
            background: var(--bg);
        }

        .fullscreen .iframe-container {
            height: calc(100vh - 80px);
            border-radius: 0;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .status-bar {
                padding: 0 20px;
            }
            
            .status-left, .status-right {
                gap: 15px;
            }
            
            .content-area {
                padding: 20px;
            }
            
            .entertainment-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 15px;
            }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Leaflet Routing Machine Styling */
        .leaflet-routing-container {
            background: rgba(10, 10, 10, 0.95) !important;
            color: white !important;
            border: 1px solid var(--border) !important;
            border-radius: 12px !important;
            padding: 15px !important;
        }

        .leaflet-routing-alt {
            background: rgba(255, 255, 255, 0.05) !important;
            color: white !important;
            padding: 10px !important;
            border-radius: 8px !important;
            margin: 5px 0 !important;
        }

        .leaflet-routing-alt h3 {
            color: var(--accent) !important;
            font-size: 1rem !important;
        }

        .leaflet-routing-alt table {
            color: white !important;
        }

        .leaflet-routing-alt td {
            color: white !important;
            padding: 8px !important;
        }

        .leaflet-routing-geocoder {
            display: none !important;
        }

        .leaflet-routing-collapse-btn {
            background: var(--accent) !important;
            color: white !important;
        }
    </style>
</head>
<body>

<div class="ambient-bg"></div>

<div class="car-system">
    <!-- Status Bar -->
    <div class="status-bar">
        <div class="status-left">
            <div class="vehicle-info">
                <h2>Kia Picanto </h2>
                <p>Strike â€¢ 2010</p>
                <p>version: 1.0.0</p>
            </div>
        </div>
        <div class="status-right">
            <div class="status-item">
                <i class="fa-solid fa-gauge-high"></i>
                <span id="speed">75 mph</span>
            </div>
            <div class="status-item">
                <i class="fa-solid fa-battery-three-quarters"></i>
                <span id="battery">68%</span>
            </div>
            <div class="status-item">
                <i class="fa-solid fa-clock"></i>
                <span id="time">3:42 PM</span>
            </div>
            <div class="status-item">
                <i class="fa-solid fa-wifi"></i>
                <span>5G</span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="content-area">
            <!--HOME VIEW -->
            <div class="view active" id="view-home">
                <h2 style="margin-bottom: 25px; font-size: 1.6rem;">AutoVerse</h2>
                
                <!--6 Apps - Clean & Simple -->
                <div class="entertainment-grid" style="margin-bottom: 30px;">
                    <div class="ent-card" onclick="switchView('movies')">
                        <i class="fa-solid fa-film"></i>
                        <h3>Movies</h3>
                    </div>
                    
                    <div class="ent-card" onclick="switchView('music')">
                        <i class="fa-solid fa-music"></i>
                        <h3>Music</h3>
                    </div>
                    
                    <div class="ent-card" onclick="switchView('games')">
                        <i class="fa-solid fa-gamepad"></i>
                        <h3>Games</h3>
                    </div>
                    
                    <div class="ent-card" onclick="switchView('map')">
                        <i class="fa-solid fa-map"></i>
                        <h3>Map</h3>
                    </div>
                    
                    <div class="ent-card" onclick="switchView('news')">
                        <i class="fa-solid fa-newspaper"></i>
                        <h3>News</h3>
                    </div>
                    
                    <div class="ent-card" onclick="switchView('settings')">
                        <i class="fa-solid fa-gear"></i>
                        <h3>Settings</h3>
                    </div>

                    <div class="card" style="padding: 10px; text-align: center;">
                        <div style="font-size: 0.7rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">Weather</div>
                        <div style="font-size: 2.2rem; font-weight: 600; color: var(--accent);" id="mobileOutsideTemp">--Â°</div>
                        <div style="font-size: 0.85rem; margin-top: 5px;" id="mobileWeatherLocation">Loading...</div>
                    </div>

                    <div class="card" style="padding: 10px; text-align: center;">
                        <div style="font-size: 0.7rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">Speed</div>
                        <div style="font-size: 2.2rem; font-weight: 600; color: var(--accent);"><span id="mobileCurrentSpeed">0</span><span style="font-size: 1rem; color: var(--text-dim);"> mph</span></div>
                        <div style="font-size: 0.85rem; margin-top: 5px;"><span id="mobileTripDistance">0.0</span> miles</div>
                    </div>

                </div>


                <!-- Navigation -->
                <div class="nav-preview">
                    <div class="nav-direction">
                        <div class="nav-icon" id="navIcon">
                            <i class="fa-solid fa-location-dot"></i>
                        </div>
                        <div class="nav-text">
                            <h4 id="navInstruction">No active navigation</h4>
                            <p id="navDistance">Tap to start</p>
                        </div>
                    </div>
                    
                    <div id="homeDirectionsList" style="display: none; margin: 15px 0; max-height: 180px; overflow-y: auto; background: var(--glass); border-radius: 12px; padding: 10px;">
                        <div style="font-size: 0.7rem; color: var(--text-dim); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px;">Directions</div>
                        <div id="directionsContent"></div>
                    </div>
                    
                    <button onclick="switchView('map')" style="width: 100%; padding: 14px; margin-top: 15px; background: var(--accent); border: none; border-radius: 12px; color: white; cursor: pointer; font-weight: 600; font-size: 0.95rem;">
                        <i class="fa-solid fa-route"></i> Navigate
                    </button>
                </div>
            </div>

            <!-- MOVIES VIEW (VazeerFlex) -->
            <div class="view" id="view-movies">
                <div class="iframe-header">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <button class="iframe-btn" onclick="switchView('home')" title="Back to Home" style="width: 45px; height: 45px; font-size: 1.2rem;">
                            <i class="fa-solid fa-arrow-left"></i>
                        </button>
                        <div>
                            <h3 style="font-size: 1.2rem;">VazeerFlex - Movies & Shows</h3>
                            <p style="font-size: 0.8rem; color: var(--text-dim); margin-top: 3px;">Live streaming from your personal library</p>
                        </div>
                    </div>
                    <div class="iframe-controls">
                        <button class="iframe-btn" onclick="reloadIframe('movies-iframe')" title="Reload">
                            <i class="fa-solid fa-rotate-right"></i>
                        </button>
                        <button class="iframe-btn" onclick="toggleFullscreen('movies-iframe')" title="Fullscreen">
                            <i class="fa-solid fa-expand"></i>
                        </button>
                        <button class="iframe-btn" onclick="openExternal('https://vazeerflex.onrender.com/')" title="Open in browser">
                            <i class="fa-solid fa-external-link"></i>
                        </button>
                    </div>
                </div>
                <div class="iframe-container">
                    <div class="loading"><i class="fa-solid fa-spinner"></i></div>
                    <iframe id="movies-iframe" src="https://vazeerflex.onrender.com/" onload="hideLoading(this)" allow="geolocation; autoplay; encrypted-media; fullscreen"></iframe>
                </div>
            </div>

            <!-- MUSIC VIEW (Music App) -->
            <div class="view" id="view-music">
                <div class="iframe-header">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <button class="iframe-btn" onclick="switchView('home')" title="Back to Home" style="width: 45px; height: 45px; font-size: 1.2rem;">
                            <i class="fa-solid fa-arrow-left"></i>
                        </button>
                        <div>
                            <h3 style="font-size: 1.2rem;">Music Player</h3>
                            <p style="font-size: 0.8rem; color: var(--text-dim); margin-top: 3px;">Your personal music collection</p>
                        </div>
                    </div>
                    <div class="iframe-controls">
                        <button class="iframe-btn" onclick="reloadIframe('music-iframe')" title="Reload">
                            <i class="fa-solid fa-rotate-right"></i>
                        </button>
                        <button class="iframe-btn" onclick="toggleFullscreen('music-iframe')" title="Fullscreen">
                            <i class="fa-solid fa-expand"></i>
                        </button>
                        <button class="iframe-btn" onclick="openExternal('https://my-music-app-okqt.onrender.com/')" title="Open in browser">
                            <i class="fa-solid fa-external-link"></i>
                        </button>
                    </div>
                </div>
                <div class="iframe-container">
                    <div class="loading"><i class="fa-solid fa-spinner"></i></div>
                    <iframe id="music-iframe" src="https://my-music-app-okqt.onrender.com/" onload="hideLoading(this)" allow="geolocation; autoplay; encrypted-media; fullscreen"></iframe>
                </div>
            </div>

            <!-- GAMES VIEW -->
            <div class="view" id="view-games">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h2 style="font-size: 1.8rem;">Game Arcade</h2>
                    <button class="iframe-btn" onclick="switchView('home')" title="Back to Home" style="width: 45px; height: 45px; font-size: 1.2rem;">
                        <i class="fa-solid fa-arrow-left"></i>
                    </button>
                </div>
                
                <div class="games-grid">
                    <div class="game-card" onclick="openGame('https://www.crazygames.com/')">
                        <div class="game-icon" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);">
                            <i class="fa-solid fa-fire"></i>
                        </div>
                        <h3>CrazyGames</h3>
                        <p>1000+ Free Games</p>
                    </div>
                    
                    <div class="game-card" onclick="openGame('https://poki.com/')">
                        <div class="game-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                            <i class="fa-solid fa-rocket"></i>
                        </div>
                        <h3>Poki</h3>
                        <p>Action & Adventure</p>
                    </div>
                    
                    <div class="game-card" onclick="openGame('https://www.addictinggames.com/')">
                        <div class="game-icon" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
                            <i class="fa-solid fa-gamepad"></i>
                        </div>
                        <h3>Addicting Games</h3>
                        <p>Puzzle & Strategy</p>
                    </div>
                    
                    <div class="game-card" onclick="openGame('https://www.miniclip.com/')">
                        <div class="game-icon" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);">
                            <i class="fa-solid fa-trophy"></i>
                        </div>
                        <h3>Miniclip</h3>
                        <p>Top Rated Games</p>
                    </div>
                    
                    <div class="game-card" onclick="openGame('https://www.msn.com/en-in/play')">
                        <div class="game-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <i class="fa-brands fa-microsoft"></i>
                        </div>
                        <h3>MSN Games</h3>
                        <p>Opens in New Tab</p>
                    </div>
                    
                    <div class="game-card" onclick="openGame('https://www.y8.com/')">
                        <div class="game-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <i class="fa-solid fa-dice"></i>
                        </div>
                        <h3>Y8 Games</h3>
                        <p>Multiplayer Games</p>
                    </div>

                    <div class="game-card" onclick="loadEmbeddedGame('chess')">
                        <div class="game-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                            <i class="fa-solid fa-chess"></i>
                        </div>
                        <h3>Chess</h3>
                        <p>Play in Browser</p>
                    </div>

                    <div class="game-card" onclick="loadEmbeddedGame('2048')">
                        <div class="game-icon" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                            <i class="fa-solid fa-grid"></i>
                        </div>
                        <h3>2048</h3>
                        <p>Puzzle Classic</p>
                    </div>

                    <div class="game-card" onclick="loadEmbeddedGame('tetris')">
                        <div class="game-icon" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                            <i class="fa-solid fa-cubes"></i>
                        </div>
                        <h3>Tetris</h3>
                        <p>Classic Arcade</p>
                    </div>
                </div>

                <!-- Embedded Game Container -->
                <div id="embedded-game-container" style="display: none; margin-top: 30px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 id="game-title" style="font-size: 1.3rem;">Now Playing</h3>
                        <button onclick="closeEmbeddedGame()" style="padding: 10px 20px; background: var(--accent); border: none; border-radius: 12px; color: white; cursor: pointer;">
                            <i class="fa-solid fa-xmark"></i> Close Game
                        </button>
                    </div>
                    <div style="background: var(--card-bg); border: 1px solid var(--border); border-radius: 20px; padding: 20px; height: 600px; overflow: hidden;">
                        <iframe id="game-frame" style="width: 100%; height: 100%; border: none; border-radius: 12px;"></iframe>
                    </div>
                </div>
            </div>

            <!-- NEWS VIEW -->
            <div class="view" id="view-news">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h2 style="font-size: 1.8rem;">Latest News</h2>
                    <button class="iframe-btn" onclick="switchView('home')" title="Back to Home" style="width: 45px; height: 45px; font-size: 1.2rem;">
                        <i class="fa-solid fa-arrow-left"></i>
                    </button>
                </div>

                <div class="entertainment-grid">
                    <div class="ent-card" onclick="openGame('https://www.msn.com/en-in/news')">
                        <i class="fa-brands fa-microsoft" style="color: #00a4ef;"></i>
                        <h3>MSN News</h3>
                        <p>Top Stories</p>
                    </div>

                    <div class="ent-card" onclick="openGame('https://news.google.com/')">
                        <i class="fa-brands fa-google" style="color: #4285f4;"></i>
                        <h3>Google News</h3>
                        <p>Personalized Feed</p>
                    </div>

                    <div class="ent-card" onclick="openGame('https://www.bbc.com/news')">
                        <i class="fa-solid fa-newspaper" style="color: #bb1919;"></i>
                        <h3>BBC News</h3>
                        <p>World News</p>
                    </div>

                    <div class="ent-card" onclick="openGame('https://timesofindia.indiatimes.com/')">
                        <i class="fa-solid fa-newspaper"></i>
                        <h3>Times of India</h3>
                        <p>India News</p>
                    </div>

                    <div class="ent-card" onclick="openGame('https://www.ndtv.com/')">
                        <i class="fa-solid fa-tv"></i>
                        <h3>NDTV</h3>
                        <p>Live Updates</p>
                    </div>

                    <div class="ent-card" onclick="openGame('https://www.hindustantimes.com/')">
                        <i class="fa-solid fa-newspaper"></i>
                        <h3>Hindustan Times</h3>
                        <p>Breaking News</p>
                    </div>
                </div>

                <div style="margin-top: 30px; padding: 20px; background: var(--glass); border: 1px solid var(--border); border-radius: 20px;">
                    <h3 style="margin-bottom: 15px; opacity: 0.8;">ðŸ“° News Opens in New Tab</h3>
                    <p style="font-size: 0.9rem; color: var(--text-dim); line-height: 1.6;">
                        Most news websites prevent iframe embedding for security. Click any source above to open news in a new browser tab. This keeps you updated with the latest headlines while you're on the road!
                    </p>
                </div>
            </div>

            <!-- MAP VIEW -->
            <div class="view" id="view-map">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="font-size: 1.8rem;">Navigation</h2>
                    <button class="iframe-btn" onclick="switchView('home')" title="Back to Home" style="width: 45px; height: 45px; font-size: 1.2rem;">
                        <i class="fa-solid fa-arrow-left"></i>
                    </button>
                </div>

                <div style="background: var(--glass); border: 1px solid var(--border); border-radius: 20px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;">Set Destination</h3>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 10px;">
                        <input type="text" id="destinationInput" placeholder="Enter destination (e.g., Paris, Eiffel Tower)" style="padding: 15px; background: var(--glass); border: 1px solid var(--border); border-radius: 12px; color: white; font-size: 1rem;">
                        <button onclick="startNavigation()" style="padding: 15px 30px; background: var(--accent); border: none; border-radius: 12px; color: white; cursor: pointer; font-weight: 600;">
                            <i class="fa-solid fa-route"></i> Navigate
                        </button>
                    </div>
                    
                    <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="document.getElementById('destinationInput').value='Paris, France'; startNavigation()" style="padding: 8px 15px; background: var(--glass); border: 1px solid var(--border); border-radius: 10px; color: white; cursor: pointer; font-size: 0.85rem;">
                            <i class="fa-solid fa-landmark"></i> Paris
                        </button>
                        <button onclick="document.getElementById('destinationInput').value='London, UK'; startNavigation()" style="padding: 8px 15px; background: var(--glass); border: 1px solid var(--border); border-radius: 10px; color: white; cursor: pointer; font-size: 0.85rem;">
                            <i class="fa-solid fa-tower"></i> London
                        </button>
                        <button onclick="document.getElementById('destinationInput').value='New York, USA'; startNavigation()" style="padding: 8px 15px; background: var(--glass); border: 1px solid var(--border); border-radius: 10px; color: white; cursor: pointer; font-size: 0.85rem;">
                            <i class="fa-solid fa-building"></i> New York
                        </button>
                        <button onclick="findNearby('restaurant')" style="padding: 8px 15px; background: var(--glass); border: 1px solid var(--border); border-radius: 10px; color: white; cursor: pointer; font-size: 0.85rem;">
                            <i class="fa-solid fa-utensils"></i> Restaurant
                        </button>
                        <button onclick="findNearby('gas station')" style="padding: 8px 15px; background: var(--glass); border: 1px solid var(--border); border-radius: 10px; color: white; cursor: pointer; font-size: 0.85rem;">
                            <i class="fa-solid fa-gas-pump"></i> Gas Station
                        </button>
                        <button onclick="findNearby('hospital')" style="padding: 8px 15px; background: var(--glass); border: 1px solid var(--border); border-radius: 10px; color: white; cursor: pointer; font-size: 0.85rem;">
                            <i class="fa-solid fa-hospital"></i> Hospital
                        </button>
                    </div>
                </div>

                <div style="background: var(--glass); border: 1px solid var(--border); border-radius: 20px; padding: 15px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 0.8rem; color: var(--text-dim); margin-bottom: 5px;">FROM</div>
                            <div id="mapSourceLocation" style="font-size: 0.9rem;">Getting your location...</div>
                        </div>
                        <div style="font-size: 2rem; color: var(--accent);">â†’</div>
                        <div style="text-align: right;">
                            <div style="font-size: 0.8rem; color: var(--text-dim); margin-bottom: 5px;">TO</div>
                            <div id="mapDestinationLocation" style="font-size: 0.9rem;">Set destination above</div>
                        </div>
                    </div>
                </div>

                <div id="map-container" style="background: var(--card-bg); border: 1px solid var(--border); border-radius: 20px; overflow: hidden; height: calc(100vh - 500px); min-height: 400px; position: relative;">
                    <div id="map-loading" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; z-index: 1000; background: var(--card-bg); padding: 30px; border-radius: 20px;">
                        <i class="fa-solid fa-map-location-dot" style="font-size: 3rem; color: var(--accent); margin-bottom: 15px;"></i>
                        <p style="color: var(--text-dim);">Set a destination to view route</p>
                    </div>
                    <div id="map" style="width: 100%; height: 100%; border-radius: 20px;"></div>
                </div>

                <div style="margin-top: 20px; padding: 15px; background: var(--glass); border: 1px solid var(--border); border-radius: 16px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                        <button onclick="zoomMap('in')" style="padding: 12px; background: var(--glass); border: 1px solid var(--border); border-radius: 10px; color: white; cursor: pointer;">
                            <i class="fa-solid fa-plus"></i> Zoom In
                        </button>
                        <button onclick="zoomMap('out')" style="padding: 12px; background: var(--glass); border: 1px solid var(--border); border-radius: 10px; color: white; cursor: pointer;">
                            <i class="fa-solid fa-minus"></i> Zoom Out
                        </button>
                        <button onclick="centerMap()" style="padding: 12px; background: var(--glass); border: 1px solid var(--border); border-radius: 10px; color: white; cursor: pointer;">
                            <i class="fa-solid fa-location-crosshairs"></i> Center
                        </button>
                    </div>
                    <button onclick="toggleMapFullscreen()" style="margin-top: 10px; width: 100%; padding: 12px; background: var(--accent); border: none; border-radius: 10px; color: white; cursor: pointer; font-weight: 600;">
                        <i class="fa-solid fa-expand"></i> Fullscreen Map
                    </button>
                </div>
            </div>
            <div class="view" id="view-settings">
                <h2 style="margin-bottom: 25px; font-size: 1.8rem;">Settings</h2>
                
                <div class="settings-list">
                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>GPS Tracking</h4>
                            <p>Real-time speed and location</p>
                        </div>
                        <div class="toggle active" onclick="toggleGPS(this)"></div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>Auto Weather Updates</h4>
                            <p>Refresh every 10 minutes</p>
                        </div>
                        <div class="toggle active" onclick="this.classList.toggle('active')"></div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>Safety Mode</h4>
                            <p>Limit features while driving</p>
                        </div>
                        <div class="toggle active" onclick="this.classList.toggle('active')"></div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>Dark Mode</h4>
                            <p>Always enabled for night driving</p>
                        </div>
                        <div class="toggle active" style="opacity: 0.5; pointer-events: none;"></div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>Location Services</h4>
                            <p id="locationStatus">Checking...</p>
                        </div>
                        <span id="locationIcon"><i class="fa-solid fa-spinner fa-spin"></i></span>
                    </div>
                </div>

                <h3 style="margin: 30px 0 20px; font-size: 1.3rem;">System Information</h3>
                <div style="padding: 20px; background: var(--glass); border: 1px solid var(--border); border-radius: 16px;">
                    <div style="display: flex; flex-direction: column; gap: 15px; font-size: 0.9rem;">
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-dim);">Weather API</span>
                            <span id="weatherStatus" style="color: var(--success);"><i class="fa-solid fa-circle" style="font-size: 0.5rem;"></i> Connected</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-dim);">GPS Status</span>
                            <span id="gpsStatus" style="color: var(--success);"><i class="fa-solid fa-circle" style="font-size: 0.5rem;"></i> Active</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-dim);">Browser</span>
                            <span id="browserInfo">Chrome</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-dim);">Screen</span>
                            <span id="screenInfo">--</span>
                        </div>
                    </div>
                </div>

                <h3 style="margin: 30px 0 20px; font-size: 1.3rem;">Connected Services</h3>
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <div style="padding: 20px; background: var(--glass); border: 1px solid var(--border); border-radius: 16px; display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <i class="fa-solid fa-film" style="font-size: 1.5rem; color: var(--accent);"></i>
                            <div>
                                <h4>VazeerFlex</h4>
                                <p style="font-size: 0.8rem; color: var(--text-dim);">vazeerflex.onrender.com</p>
                            </div>
                        </div>
                        <span style="color: var(--success); font-size: 0.85rem;"><i class="fa-solid fa-circle" style="font-size: 0.5rem;"></i> Connected</span>
                    </div>
                    <div style="padding: 20px; background: var(--glass); border: 1px solid var(--border); border-radius: 16px; display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <i class="fa-solid fa-music" style="font-size: 1.5rem; color: var(--accent);"></i>
                            <div>
                                <h4>Music App</h4>
                                <p style="font-size: 0.8rem; color: var(--text-dim);">my-music-app-okqt.onrender.com</p>
                            </div>
                        </div>
                        <span style="color: var(--success); font-size: 0.85rem;"><i class="fa-solid fa-circle" style="font-size: 0.5rem;"></i> Connected</span>
                    </div>
                </div>

                <h3 style="margin: 30px 0 20px; font-size: 1.3rem;">External Links</h3>
                <div style="padding: 20px; background: var(--glass); border: 1px solid var(--border); border-radius: 16px;">
                    <p style="font-size: 0.9rem; color: var(--text-dim); line-height: 1.6; margin-bottom: 15px;">
                        Games and News open in new browser tabs due to website security policies. This ensures you get the full experience without restrictions.
                    </p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <span style="padding: 8px 15px; background: var(--glass); border: 1px solid var(--border); border-radius: 8px; font-size: 0.85rem;">
                            <i class="fa-solid fa-gamepad"></i> Games Portal
                        </span>
                        <span style="padding: 8px 15px; background: var(--glass); border: 1px solid var(--border); border-radius: 8px; font-size: 0.85rem;">
                            <i class="fa-solid fa-newspaper"></i> News Sources
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Sidebar -->
        <div class="sidebar">
            <!-- Live Weather Widget -->
            <div class="sidebar-section" id="weatherWidget">
                <h4>Current Weather</h4>
                <div style="text-align: center;">
                    <div style="font-size: 3rem; color: var(--accent); margin: 10px 0;" id="outsideTemp">--Â°</div>
                    <p style="font-size: 0.95rem; font-weight: 500; margin-bottom: 5px;" id="weatherLocation">Loading...</p>
                    <p style="font-size: 0.85rem; color: var(--text-dim); margin-bottom: 15px;" id="weatherDesc">Fetching weather...</p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.8rem; color: var(--text-dim);">
                        <div style="background: var(--glass); padding: 10px; border-radius: 10px;">
                            <i class="fa-solid fa-droplet" style="color: var(--accent);"></i>
                            <div id="humidity" style="margin-top: 5px; font-weight: 600; color: white;">--%</div>
                            <div style="font-size: 0.7rem;">Humidity</div>
                        </div>
                        <div style="background: var(--glass); padding: 10px; border-radius: 10px;">
                            <i class="fa-solid fa-wind" style="color: var(--accent);"></i>
                            <div id="windSpeed" style="margin-top: 5px; font-weight: 600; color: white;">--</div>
                            <div style="font-size: 0.7rem;">Wind</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Trip Info with LIVE DATA -->
            <div class="sidebar-section">
                <h4>Live Trip Data</h4>
                <div class="trip-stats">
                    <div class="stat-box">
                        <span class="value" id="currentSpeed">0</span>
                        <span class="label">mph</span>
                    </div>
                    <div class="stat-box">
                        <span class="value" id="tripDistance">0.0</span>
                        <span class="label">Miles</span>
                    </div>
                    <div class="stat-box">
                        <span class="value" id="tripDuration">0m</span>
                        <span class="label">Duration</span>
                    </div>
                    <div class="stat-box">
                        <span class="value" id="avgSpeed">0</span>
                        <span class="label">Avg Speed</span>
                    </div>
                </div>
                <button onclick="resetTrip()" style="margin-top: 15px; width: 100%; padding: 10px; background: var(--glass); border: 1px solid var(--border); border-radius: 12px; color: white; cursor: pointer; font-size: 0.85rem;">
                    <i class="fa-solid fa-rotate-right"></i> Reset Trip
                </button>
            </div>

            <!-- Quick Actions -->
            <div class="sidebar-section">
                <h4>Quick Actions</h4>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <button onclick="window.location.href='tel:+1234567890'" style="padding: 15px; background: var(--glass); border: 1px solid var(--border); border-radius: 12px; color: white; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: all 0.3s ease;">
                        <i class="fa-solid fa-phone"></i>
                        <span>Emergency Call</span>
                    </button>
                    <button onclick="switchView('map')" style="padding: 15px; background: var(--glass); border: 1px solid var(--border); border-radius: 12px; color: white; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: all 0.3s ease;">
                        <i class="fa-solid fa-map"></i>
                        <span>Navigation</span>
                    </button>
                    <button onclick="shareLocation()" style="padding: 15px; background: var(--glass); border: 1px solid var(--border); border-radius: 12px; color: white; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: all 0.3s ease;">
                        <i class="fa-solid fa-location-dot"></i>
                        <span>Share Location</span>
                    </button>
                </div>
            </div>

            <!-- Now Streaming -->
            <div class="sidebar-section" id="nowStreaming" style="display: none;">
                <h4>Now Streaming</h4>
                <div style="text-align: center;">
                    <div style="width: 100%; height: 120px; background: linear-gradient(135deg, var(--accent) 0%, var(--accent-secondary) 100%); border-radius: 12px; margin-bottom: 15px; display: flex; align-items: center; justify-content: center;">
                        <i class="fa-solid fa-film" style="font-size: 3rem; color: white;"></i>
                    </div>
                    <h4 id="streamingTitle" style="margin-bottom: 5px;">Content Title</h4>
                    <p id="streamingSource" style="font-size: 0.8rem; color: var(--text-dim);">VazeerFlex</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <button class="nav-btn active" onclick="switchView('home')">
            <i class="fa-solid fa-house"></i>
            <span>Home</span>
        </button>
        <button class="nav-btn" onclick="switchView('movies')">
            <i class="fa-solid fa-film"></i>
            <span>Movies</span>
        </button>
        <button class="nav-btn" onclick="switchView('music')">
            <i class="fa-solid fa-music"></i>
            <span>Music</span>
        </button>
        <button class="nav-btn" onclick="switchView('map')">
            <i class="fa-solid fa-map"></i>
            <span>Map</span>
        </button>
        <button class="nav-btn" onclick="switchView('games')">
            <i class="fa-solid fa-gamepad"></i>
            <span>Games</span>
        </button>
        <button class="nav-btn" onclick="switchView('settings')">
            <i class="fa-solid fa-gear"></i>
            <span>Settings</span>
        </button>
    </div>
</div>

<script>
// ============================================
// REAL API INTEGRATION - ACTIVE
// ============================================

// Update time
function updateTime() {
    const now = new Date();
    const timeStr = now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
    document.getElementById('time').textContent = timeStr;
}
setInterval(updateTime, 1000);
updateTime();

// ============================================
// 1. REAL WEATHER DATA with your API key!
// ============================================
async function getRealWeather() {
    try {
        const API_KEY = '90c270e247e81a5e90af75efac65d4f7'; // Your API key

        // Get current GPS position
        navigator.geolocation.getCurrentPosition(async (position) => {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric`;
            
            const response = await fetch(url);
            const data = await response.json();
            
            if (data.cod === 200) {
                // Update weather display (both sidebar and mobile)
                const temp = Math.round(data.main.temp);
                const description = data.weather[0].description;
                const humidity = data.main.humidity;
                const windSpeed = Math.round(data.wind.speed * 2.237); // Convert m/s to mph
                const location = data.name;
                const weatherMain = data.weather[0].main.toLowerCase();
                
                // Weather icon based on condition
                let weatherIcon = 'fa-cloud';
                if (weatherMain.includes('rain')) weatherIcon = 'fa-cloud-rain';
                else if (weatherMain.includes('snow')) weatherIcon = 'fa-snowflake';
                else if (weatherMain.includes('clear')) weatherIcon = 'fa-sun';
                else if (weatherMain.includes('thunder')) weatherIcon = 'fa-cloud-bolt';
                else if (weatherMain.includes('drizzle')) weatherIcon = 'fa-cloud-drizzle';
                else if (weatherMain.includes('mist') || weatherMain.includes('fog')) weatherIcon = 'fa-smog';
                
                // Update sidebar weather
                document.getElementById('outsideTemp').textContent = temp + 'Â°C';
                document.getElementById('weatherLocation').innerHTML = `<i class="fa-solid ${weatherIcon}" style="margin-right: 8px;"></i>${location}`;
                document.getElementById('weatherDesc').textContent = 
                    description.charAt(0).toUpperCase() + description.slice(1);
                document.getElementById('humidity').textContent = humidity + '%';
                document.getElementById('windSpeed').textContent = windSpeed + ' mph';
                
                // Update mobile weather widgets
                const mobileTemp = document.getElementById('mobileOutsideTemp');
                const mobileLocation = document.getElementById('mobileWeatherLocation');
                const mobileDesc = document.getElementById('mobileWeatherDesc');
                const mobileHumidity = document.getElementById('mobileHumidity');
                const mobileWind = document.getElementById('mobileWindSpeed');
                
                if (mobileTemp) mobileTemp.textContent = temp + 'Â°C';
                if (mobileLocation) mobileLocation.innerHTML = `<i class="fa-solid ${weatherIcon}" style="margin-right: 8px;"></i>${location}`;
                if (mobileDesc) mobileDesc.textContent = description.charAt(0).toUpperCase() + description.slice(1);
                if (mobileHumidity) mobileHumidity.textContent = humidity + '%';
                if (mobileWind) mobileWind.textContent = windSpeed + ' mph';
                
                // Update settings status
                document.getElementById('weatherStatus').innerHTML = '<i class="fa-solid fa-circle" style="font-size: 0.5rem;"></i> Connected';
                document.getElementById('weatherStatus').style.color = 'var(--success)';
                
                console.log('âœ… Weather updated:', location, temp + 'Â°C');
            }
        }, (error) => {
            console.log('GPS error for weather:', error);
            document.getElementById('weatherDesc').textContent = 'Enable GPS for weather';
        });

    } catch(error) {
        console.log('Weather API error:', error);
        document.getElementById('weatherDesc').textContent = 'Weather unavailable';
        document.getElementById('weatherStatus').innerHTML = '<i class="fa-solid fa-circle" style="font-size: 0.5rem;"></i> Error';
        document.getElementById('weatherStatus').style.color = 'var(--danger)';
    }
}

// Get weather immediately and refresh every 10 minutes
getRealWeather();
setInterval(getRealWeather, 600000);

// ============================================
// 2. REAL GPS SPEED TRACKING
// ============================================
let tripData = {
    startTime: new Date(),
    totalDistance: 0,
    lastPosition: null,
    speeds: [],
    isTracking: true
};

function getRealGPSSpeed() {
    if ("geolocation" in navigator) {
        navigator.geolocation.watchPosition(
            (position) => {
                if (!tripData.isTracking) return;
                
                // Get speed from GPS (meters per second)
                const speedMPS = position.coords.speed || 0;
                const speedMPH = Math.round(speedMPS * 2.237);
                
                // Update current speed displays (both sidebar and mobile)
                if (speedMPH >= 0) {
                    document.getElementById('speed').textContent = speedMPH + ' mph';
                    document.getElementById('currentSpeed').textContent = speedMPH;
                    
                    // Update mobile version
                    const mobileSpeed = document.getElementById('mobileCurrentSpeed');
                    if (mobileSpeed) mobileSpeed.textContent = speedMPH;
                    
                    // Track for average
                    if (speedMPH > 0) {
                        tripData.speeds.push(speedMPH);
                    }
                }
                
                // Calculate distance traveled
                if (tripData.lastPosition) {
                    const distance = calculateDistance(
                        tripData.lastPosition.latitude,
                        tripData.lastPosition.longitude,
                        position.coords.latitude,
                        position.coords.longitude
                    );
                    tripData.totalDistance += distance;
                    document.getElementById('tripDistance').textContent = tripData.totalDistance.toFixed(1);
                }
                
                tripData.lastPosition = position.coords;
                
                // Calculate average speed
                if (tripData.speeds.length > 0) {
                    const avg = tripData.speeds.reduce((a, b) => a + b, 0) / tripData.speeds.length;
                    const avgRounded = Math.round(avg);
                    document.getElementById('avgSpeed').textContent = avgRounded;
                    
                    // Update mobile version
                    const mobileAvg = document.getElementById('mobileAvgSpeed');
                    if (mobileAvg) mobileAvg.textContent = avgRounded;
                }
                
                // Update trip duration
                updateTripDuration();
                
                // Update GPS status
                document.getElementById('gpsStatus').innerHTML = '<i class="fa-solid fa-circle" style="font-size: 0.5rem;"></i> Active';
                document.getElementById('gpsStatus').style.color = 'var(--success)';
            },
            (error) => {
                console.log('GPS error:', error);
                document.getElementById('speed').textContent = '0 mph';
                document.getElementById('gpsStatus').innerHTML = '<i class="fa-solid fa-circle" style="font-size: 0.5rem;"></i> Disabled';
                document.getElementById('gpsStatus').style.color = 'var(--danger)';
            },
            { 
                enableHighAccuracy: true, 
                maximumAge: 0, 
                timeout: 5000 
            }
        );
        console.log('âœ… GPS speed tracking started');
    } else {
        console.log('âš ï¸ Geolocation not available');
        document.getElementById('gpsStatus').innerHTML = '<i class="fa-solid fa-circle" style="font-size: 0.5rem;"></i> Not Available';
    }
}

// Calculate distance between two GPS coordinates (Haversine formula)
function calculateDistance(lat1, lon1, lat2, lon2) {
    const R = 3959; // Earth's radius in miles
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
              Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
              Math.sin(dLon/2) * Math.sin(dLon/2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c;
}

// Update trip duration
function updateTripDuration() {
    const now = new Date();
    const duration = (now - tripData.startTime) / 1000 / 60; // minutes
    
    let durationText;
    if (duration < 60) {
        durationText = Math.round(duration) + 'm';
    } else {
        const hours = Math.floor(duration / 60);
        const minutes = Math.round(duration % 60);
        durationText = `${hours}h ${minutes}m`;
    }
    
    document.getElementById('tripDuration').textContent = durationText;
    
    // Update mobile version
    const mobileDuration = document.getElementById('mobileTripDuration');
    if (mobileDuration) mobileDuration.textContent = durationText;
}

// Reset trip data
function resetTrip() {
    if (confirm('Reset trip data?')) {
        tripData = {
            startTime: new Date(),
            totalDistance: 0,
            lastPosition: null,
            speeds: [],
            isTracking: true
        };
        document.getElementById('tripDistance').textContent = '0.0';
        document.getElementById('tripDuration').textContent = '0m';
        document.getElementById('avgSpeed').textContent = '0';
        console.log('Trip data reset');
    }
}

// Toggle GPS tracking
function toggleGPS(element) {
    element.classList.toggle('active');
    const isActive = element.classList.contains('active');
    tripData.isTracking = isActive;
    
    if (isActive && !locationPermissionGranted) {
        // Re-request location permission
        if (locationWatchId) {
            navigator.geolocation.clearWatch(locationWatchId);
            locationWatchId = null;
        }
        trackUserLocation();
        alert('Please allow location access when prompted by your browser.');
    }
    
    console.log('GPS tracking:', tripData.isTracking ? 'enabled' : 'disabled');
}

// Start GPS tracking
getRealGPSSpeed();

// Update trip duration every minute
setInterval(updateTripDuration, 60000);

// ============================================
// 3. LOCATION SERVICES STATUS
// ============================================
function checkLocationServices() {
    if ("permissions" in navigator) {
        navigator.permissions.query({ name: 'geolocation' }).then((result) => {
            const statusElement = document.getElementById('locationStatus');
            const iconElement = document.getElementById('locationIcon');
            
            if (result.state === 'granted') {
                statusElement.textContent = 'Enabled and active';
                iconElement.innerHTML = '<i class="fa-solid fa-check-circle" style="color: var(--success);"></i>';
            } else if (result.state === 'prompt') {
                statusElement.textContent = 'Click to enable';
                iconElement.innerHTML = '<i class="fa-solid fa-exclamation-circle" style="color: var(--accent);"></i>';
            } else {
                statusElement.textContent = 'Disabled';
                iconElement.innerHTML = '<i class="fa-solid fa-times-circle" style="color: var(--danger);"></i>';
            }
        });
    }
}

setTimeout(checkLocationServices, 2000);

// ============================================
// 4. SYSTEM INFO
// ============================================
function updateSystemInfo() {
    // Browser detection
    const ua = navigator.userAgent;
    let browser = 'Unknown';
    if (ua.includes('Chrome')) browser = 'Chrome';
    else if (ua.includes('Firefox')) browser = 'Firefox';
    else if (ua.includes('Safari')) browser = 'Safari';
    else if (ua.includes('Edge')) browser = 'Edge';
    
    document.getElementById('browserInfo').textContent = browser;
    
    // Screen info
    const screen = window.screen;
    document.getElementById('screenInfo').textContent = 
        `${screen.width}x${screen.height}`;
}

updateSystemInfo();

// ============================================
// 5. QUICK ACTIONS
// ============================================
function shareLocation() {
    if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition((position) => {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            const url = `https://www.google.com/maps?q=${lat},${lon}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'My Location',
                    text: 'Here is my current location',
                    url: url
                });
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(url);
                alert('Location link copied to clipboard!');
            }
        });
    }
}

// ============================================
// 6. BATTERY STATUS (Phone fallback)
// ============================================
if ('getBattery' in navigator) {
    navigator.getBattery().then(battery => {
        const updateBattery = () => {
            const level = Math.floor(battery.level * 100);
            document.getElementById('battery').textContent = level + '%';
        };
        
        updateBattery();
        battery.addEventListener('levelchange', updateBattery);
        battery.addEventListener('chargingchange', updateBattery);
    });
} else {
    // Default battery display
    document.getElementById('battery').textContent = 'N/A';
}

console.log('====================================');
console.log('ðŸš— Car Entertainment System Ready!');
console.log('====================================');
console.log('âœ… Weather API: Checking...');
console.log('âœ… GPS Speed: Active');
console.log('âœ… Navigation: OpenStreetMap (Free)');
console.log('');
console.log('âš ï¸ All systems operational!');
console.log('====================================');

// ============================================
// LEAFLET.JS OPENSTREETMAP NAVIGATION
// ============================================
let userLocation = null;
let currentDestination = null;
let map = null;
let userMarker = null;
let routingControl = null;

// Initialize map when map view is opened
function initializeMap() {
    if (map) return; // Already initialized
    
    // Create map centered on default location
    map = L.map('map').setView([51.5074, -0.1278], 13); // London default
    
    // Add OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors',
        maxZoom: 19
    }).addTo(map);
    
    // Add user location marker when available
    if (userLocation) {
        updateMapLocation();
    }
    
    console.log('âœ… Map initialized');
}

// Track user location
let locationWatchId = null;
let locationPermissionGranted = false;

function trackUserLocation() {
    if ("geolocation" in navigator) {
        // Only request once
        if (locationWatchId) return;
        
        // Force permission request immediately
        locationWatchId = navigator.geolocation.watchPosition(
            (position) => {
                locationPermissionGranted = true;
                userLocation = {
                    lat: position.coords.latitude,
                    lon: position.coords.longitude
                };
                
                // Update location displays
                const locationText = `${userLocation.lat.toFixed(4)}, ${userLocation.lon.toFixed(4)}`;
                const currentLocEl = document.getElementById('currentLocation');
                if (currentLocEl) currentLocEl.textContent = locationText;
                
                const mapSourceEl = document.getElementById('mapSourceLocation');
                if (mapSourceEl) mapSourceEl.textContent = locationText;
                
                // Update map if it exists
                updateMapLocation();
                
                console.log('âœ… Location permission granted');
            },
            (error) => {
                console.log('Location tracking error:', error);
                const currentLocEl = document.getElementById('currentLocation');
                if (currentLocEl) currentLocEl.textContent = 'Enable location in browser';
                
                const mapSourceEl = document.getElementById('mapSourceLocation');
                if (mapSourceEl) mapSourceEl.textContent = 'Enable GPS';
                
                // Show alert for GitHub Pages
                if (window.location.protocol === 'https:') {
                    console.warn('âš ï¸ Please allow location access in your browser settings');
                }
            },
            { enableHighAccuracy: true, maximumAge: 10000, timeout: 5000 }
        );
    } else {
        console.error('âŒ Geolocation not supported');
        alert('Your browser does not support geolocation. Please use Chrome, Firefox, or Safari.');
    }
}

// Request location permission on page load
window.addEventListener('load', function() {
    // Small delay to ensure DOM is ready
    setTimeout(trackUserLocation, 500);
});

// Also call immediately
trackUserLocation();

// Update map with user location
function updateMapLocation() {
    if (!map || !userLocation) return;
    
    // Remove old marker if exists
    if (userMarker) {
        map.removeLayer(userMarker);
    }
    
    // Add new marker at user location
    userMarker = L.marker([userLocation.lat, userLocation.lon], {
        icon: L.icon({
            iconUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAiIGhlaWdodD0iMzAiIHZpZXdCb3g9IjAgMCAzMCAzMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIxNSIgY3k9IjE1IiByPSIxMCIgZmlsbD0iIzAwZDJmZiIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIzIi8+PC9zdmc+',
            iconSize: [30, 30],
            iconAnchor: [15, 15]
        })
    }).addTo(map);
    
    userMarker.bindPopup('ðŸ“ Your Location').openPopup();
    
    // Center map on user location
    map.setView([userLocation.lat, userLocation.lon], 13);
}

// Geocode destination and show route
async function startNavigation() {
    const destination = document.getElementById('destinationInput').value.trim();
    
    if (!destination) {
        alert('Please enter a destination');
        return;
    }
    
    if (!userLocation) {
        alert('Getting your location... Please wait and try again.');
        return;
    }
    
    // Initialize map if not already done
    if (!map) {
        initializeMap();
    }
    
    // Hide loading message
    document.getElementById('map-loading').style.display = 'none';
    
    currentDestination = destination;
    
    // Update destination display
    document.getElementById('mapDestinationLocation').textContent = destination;
    document.getElementById('navInstruction').textContent = `Searching for ${destination}...`;
    document.getElementById('navDistance').textContent = 'Calculating route...';
    
    try {
        // Geocode with user location as viewbox to prioritize nearby results
        const viewbox = `${userLocation.lon - 0.5},${userLocation.lat - 0.5},${userLocation.lon + 0.5},${userLocation.lat + 0.5}`;
        const geocodeUrl = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(destination)}&viewbox=${viewbox}&bounded=1&limit=5`;
        
        // If bounded search fails, try unbounded but still prioritize by proximity
        let response = await fetch(geocodeUrl);
        let data = await response.json();
        
        // If no results with bounded search, try proximity search
        if (!data || data.length === 0) {
            const proximityUrl = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(destination)}&lat=${userLocation.lat}&lon=${userLocation.lon}&limit=5`;
            response = await fetch(proximityUrl);
            data = await response.json();
        }
        
        if (data && data.length > 0) {
            // Find closest result
            let closestResult = data[0];
            let minDistance = Infinity;
            
            data.forEach(result => {
                const resultLat = parseFloat(result.lat);
                const resultLon = parseFloat(result.lon);
                
                // Calculate distance from user
                const distance = Math.sqrt(
                    Math.pow(resultLat - userLocation.lat, 2) + 
                    Math.pow(resultLon - userLocation.lon, 2)
                );
                
                if (distance < minDistance) {
                    minDistance = distance;
                    closestResult = result;
                }
            });
            
            const destLat = parseFloat(closestResult.lat);
            const destLon = parseFloat(closestResult.lon);
            
            // Show which result was selected
            document.getElementById('mapDestinationLocation').textContent = closestResult.display_name;
            
            // Remove old routing control if exists
            if (routingControl) {
                map.removeControl(routingControl);
            }
            
            // Add routing control with waypoints
            routingControl = L.Routing.control({
                waypoints: [
                    L.latLng(userLocation.lat, userLocation.lon),
                    L.latLng(destLat, destLon)
                ],
                routeWhileDragging: false,
                showAlternatives: false,
                addWaypoints: false,
                draggableWaypoints: false,
                fitSelectedRoutes: true,
                lineOptions: {
                    styles: [{color: '#00d2ff', opacity: 0.8, weight: 6}]
                },
                createMarker: function(i, waypoint, n) {
                    const marker = L.marker(waypoint.latLng, {
                        icon: L.icon({
                            iconUrl: i === 0 ? 
                                'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAiIGhlaWdodD0iMzAiIHZpZXdCb3g9IjAgMCAzMCAzMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIxNSIgY3k9IjE1IiByPSIxMCIgZmlsbD0iIzAwZDJmZiIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIzIi8+PC9zdmc+' :
                                'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCAzMCA0MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTUgMEMxMC4wMyAwIDYgNC4wMyA2IDE5QzYgMTMuOTcgMTUgNDAgMTUgNDBTMjQgMjMuOTcgMjQgOUMyNCA0LjAzIDE5Ljk3IDAgMTUgMFoiIGZpbGw9IiNmZjRkNGQiLz48Y2lyY2xlIGN4PSIxNSIgY3k9IjkiIHI9IjUiIGZpbGw9IndoaXRlIi8+PC9zdmc+',
                            iconSize: [30, i === 0 ? 30 : 40],
                            iconAnchor: [15, i === 0 ? 15 : 40]
                        })
                    });
                    
                    marker.bindPopup(i === 0 ? 'ðŸš— Start' : 'ðŸ Destination');
                    return marker;
                },
                containerClassName: 'leaflet-routing-container-custom'
            }).addTo(map);
            
            // Listen for route found event
            routingControl.on('routesfound', function(e) {
                const routes = e.routes;
                const summary = routes[0].summary;
                const instructions = routes[0].instructions;
                
                // Update UI with route info
                const distanceKm = (summary.totalDistance / 1000).toFixed(1);
                const distanceMiles = (distanceKm * 0.621371).toFixed(1);
                const timeMinutes = Math.round(summary.totalTime / 60);
                
                document.getElementById('navDistance').textContent = `${distanceMiles} miles (${distanceKm} km)`;
                document.getElementById('navETA').textContent = `ETA: ${timeMinutes} min`;
                
                // Update home screen with first instruction
                if (instructions && instructions.length > 0) {
                    const firstInstruction = instructions[0];
                    const navInstructionEl = document.getElementById('navInstruction');
                    if (navInstructionEl) {
                        navInstructionEl.textContent = firstInstruction.text || `Navigate to ${destination}`;
                    }
                    
                    // Show turn-by-turn on home screen
                    const homeDirectionsList = document.getElementById('homeDirectionsList');
                    const directionsContent = document.getElementById('directionsContent');
                    
                    if (homeDirectionsList && directionsContent) {
                        homeDirectionsList.style.display = 'block';
                        directionsContent.innerHTML = '';
                        
                        // Show first 5 instructions
                        instructions.slice(0, 5).forEach((instruction, index) => {
                            const directionDiv = document.createElement('div');
                            directionDiv.style.cssText = 'padding: 8px; margin-bottom: 5px; background: var(--glass); border-radius: 8px; font-size: 0.85rem; display: flex; align-items: center; gap: 10px;';
                            
                            const iconSpan = document.createElement('span');
                            iconSpan.style.cssText = 'color: var(--accent); min-width: 20px;';
                            iconSpan.textContent = `${index + 1}.`;
                            
                            const textSpan = document.createElement('span');
                            textSpan.textContent = instruction.text;
                            
                            const distSpan = document.createElement('span');
                            distSpan.style.cssText = 'margin-left: auto; color: var(--text-dim); font-size: 0.75rem;';
                            distSpan.textContent = (instruction.distance / 1609.34).toFixed(1) + ' mi';
                            
                            directionDiv.appendChild(iconSpan);
                            directionDiv.appendChild(textSpan);
                            directionDiv.appendChild(distSpan);
                            directionsContent.appendChild(directionDiv);
                        });
                        
                        if (instructions.length > 5) {
                            const moreDiv = document.createElement('div');
                            moreDiv.style.cssText = 'padding: 8px; text-align: center; color: var(--text-dim); font-size: 0.8rem;';
                            moreDiv.textContent = `+ ${instructions.length - 5} more steps`;
                            directionsContent.appendChild(moreDiv);
                        }
                    }
                }
                
                console.log(`âœ… Route found: ${distanceMiles} miles, ${timeMinutes} minutes`);
            });
            
            console.log('âœ… Navigation started to:', closestResult.display_name);
        } else {
            alert('Destination not found. Please try:\n- Full address (e.g., "123 Main St, City")\n- Landmark name (e.g., "Eiffel Tower")\n- Or use quick buttons below');
            document.getElementById('navDistance').textContent = 'Destination not found';
        }
    } catch (error) {
        console.error('Navigation error:', error);
        alert('Error finding route. Please check your internet connection.');
    }
}

// Find nearby places
async function findNearby(placeType) {
    if (!userLocation) {
        alert('Getting your location...');
        return;
    }
    
    // Initialize map if not already done
    if (!map) {
        initializeMap();
    }
    
    document.getElementById('map-loading').style.display = 'none';
    
    // Search for nearby places using Overpass API (better for "near me" searches)
    // Create bounding box around user (about 10km radius)
    const radius = 0.1; // degrees (roughly 10km)
    const bbox = `${userLocation.lat - radius},${userLocation.lon - radius},${userLocation.lat + radius},${userLocation.lon + radius}`;
    
    // Use Nominatim with bounded search
    const searchUrl = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(placeType)}&viewbox=${userLocation.lon - radius},${userLocation.lat - radius},${userLocation.lon + radius},${userLocation.lat + radius}&bounded=1&limit=10`;
    
    try {
        const response = await fetch(searchUrl);
        const data = await response.json();
        
        if (data && data.length > 0) {
            // Clear old markers except user marker
            map.eachLayer(function(layer) {
                if (layer instanceof L.Marker && layer !== userMarker) {
                    map.removeLayer(layer);
                }
            });
            
            // Remove old routing
            if (routingControl) {
                map.removeControl(routingControl);
            }
            
            // Calculate distance for each result
            const resultsWithDistance = data.map(place => {
                const placeLat = parseFloat(place.lat);
                const placeLon = parseFloat(place.lon);
                
                // Calculate distance in km
                const R = 6371; // Earth radius in km
                const dLat = (placeLat - userLocation.lat) * Math.PI / 180;
                const dLon = (placeLon - userLocation.lon) * Math.PI / 180;
                const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                         Math.cos(userLocation.lat * Math.PI / 180) * Math.cos(placeLat * Math.PI / 180) *
                         Math.sin(dLon/2) * Math.sin(dLon/2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                const distance = R * c;
                
                return { ...place, distance };
            });
            
            // Sort by distance
            resultsWithDistance.sort((a, b) => a.distance - b.distance);
            
            // Add markers for closest 5 results
            resultsWithDistance.slice(0, 5).forEach((place, index) => {
                const marker = L.marker([parseFloat(place.lat), parseFloat(place.lon)], {
                    icon: L.icon({
                        iconUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMzUiIHZpZXdCb3g9IjAgMCAyNSAzNSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTIuNSAwQzguMzYgMCA1IDMuMzYgNSA3LjVDNSAxMS42NSAxMi41IDM1IDEyLjUgMzVTMjAgMTEuNjUgMjAgNy41QzIwIDMuMzYgMTYuNjQgMCAxMi41IDBaIiBmaWxsPSIjZmY5NTAwIi8+PGNpcmNsZSBjeD0iMTIuNSIgY3k9IjcuNSIgcj0iNCIgZmlsbD0id2hpdGUiLz48L3N2Zz4=',
                        iconSize: [25, 35],
                        iconAnchor: [12.5, 35]
                    })
                });
                
                const distanceMiles = (place.distance * 0.621371).toFixed(1);
                marker.bindPopup(`
                    <b>${index + 1}. ${place.display_name}</b><br>
                    Distance: ${distanceMiles} miles<br>
                    <button onclick="navigateToCoords(${place.lat}, ${place.lon}, '${place.display_name.replace(/'/g, "\\'")}')">Navigate Here</button>
                `);
                marker.addTo(map);
                
                // Open first marker popup
                if (index === 0) {
                    marker.openPopup();
                }
            });
            
            // Use closest result as destination
            const closest = resultsWithDistance[0];
            document.getElementById('destinationInput').value = closest.display_name;
            document.getElementById('mapDestinationLocation').textContent = `Nearby ${placeType} (${(closest.distance * 0.621371).toFixed(1)} mi away)`;
            
            // Adjust map view to show all markers
            const group = L.featureGroup(map.getLayers().filter(layer => layer instanceof L.Marker));
            map.fitBounds(group.getBounds().pad(0.1));
            
            console.log(`âœ… Found ${data.length} ${placeType}(s) nearby`);
        } else {
            alert(`No ${placeType} found nearby. Try a wider search area.`);
        }
    } catch (error) {
        console.error('Search error:', error);
        alert('Error searching nearby. Please try again.');
    }
}

// Navigate to specific coordinates (used by nearby search popups)
function navigateToCoords(lat, lon, name) {
    document.getElementById('destinationInput').value = name;
    document.getElementById('mapDestinationLocation').textContent = name;
    
    // Remove old routing
    if (routingControl) {
        map.removeControl(routingControl);
    }
    
    // Add new route
    routingControl = L.Routing.control({
        waypoints: [
            L.latLng(userLocation.lat, userLocation.lon),
            L.latLng(lat, lon)
        ],
        routeWhileDragging: false,
        showAlternatives: false,
        addWaypoints: false,
        draggableWaypoints: false,
        fitSelectedRoutes: true,
        lineOptions: {
            styles: [{color: '#00d2ff', opacity: 0.8, weight: 6}]
        },
        containerClassName: 'leaflet-routing-container-custom'
    }).addTo(map);
    
    console.log('âœ… Navigating to:', name);
}

// Map controls
function zoomMap(direction) {
    if (!map) return;
    
    if (direction === 'in') {
        map.zoomIn();
    } else {
        map.zoomOut();
    }
}

function centerMap() {
    if (!map || !userLocation) return;
    
    map.setView([userLocation.lat, userLocation.lon], 13);
}

function toggleMapFullscreen() {
    const mapContainer = document.getElementById('map-container');
    
    if (!document.fullscreenElement) {
        if (mapContainer.requestFullscreen) {
            mapContainer.requestFullscreen();
        } else if (mapContainer.webkitRequestFullscreen) {
            mapContainer.webkitRequestFullscreen();
        }
    } else {
        document.exitFullscreen();
    }
}

// Alternative: Quick navigation function for backward compatibility
function openNavigation() {
    switchView('map');
    setTimeout(() => {
        if (!map) initializeMap();
    }, 100);
}

function setDestination() {
    switchView('map');
    setTimeout(() => {
        if (!map) initializeMap();
    }, 100);
}

// Initialize map when switching to map view
document.addEventListener('DOMContentLoaded', function() {
    // Watch for view changes
    const originalSwitchView = window.switchView;
    window.switchView = function(viewName) {
        originalSwitchView(viewName);
        
        if (viewName === 'map' && !map) {
            setTimeout(initializeMap, 100);
        }
    };
});

// ============================================
// GAMES & NEWS FUNCTIONS
// ============================================

function openGame(url) {
    window.open(url, '_blank');
}

function loadEmbeddedGame(gameType) {
    const container = document.getElementById('embedded-game-container');
    const frame = document.getElementById('game-frame');
    const title = document.getElementById('game-title');
    
    const games = {
        'chess': {
            url: 'https://www.chess.com/play/computer',
            title: 'â™Ÿï¸ Chess'
        },
        '2048': {
            url: 'https://play2048.co/',
            title: 'ðŸŽ® 2048'
        },
        'tetris': {
            url: 'https://tetris.com/play-tetris',
            title: 'ðŸ§± Tetris'
        }
    };
    
    if (games[gameType]) {
        title.textContent = games[gameType].title;
        frame.src = games[gameType].url;
        container.style.display = 'block';
        
        // Scroll to game
        container.scrollIntoView({ behavior: 'smooth' });
    }
}

function closeEmbeddedGame() {
    const container = document.getElementById('embedded-game-container');
    const frame = document.getElementById('game-frame');
    
    frame.src = '';
    container.style.display = 'none';
}


// View switching
function switchView(viewName) {
    // Update views
    document.querySelectorAll('.view').forEach(view => {
        view.classList.remove('active');
    });
    document.getElementById('view-' + viewName).classList.add('active');
    
    // Update nav buttons
    document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.currentTarget.classList.add('active');

    // Show/hide streaming info
    const nowStreaming = document.getElementById('nowStreaming');
    if (viewName === 'movies' || viewName === 'music' || viewName === 'games' || viewName === 'news') {
        nowStreaming.style.display = 'block';
        const sourceMap = {
            'movies': 'VazeerFlex',
            'music': 'Music App',
            'games': 'MSN Games',
            'news': 'MSN News'
        };
        document.getElementById('streamingSource').textContent = sourceMap[viewName];
    } else {
        nowStreaming.style.display = 'none';
    }
}

// Temperature control
let currentTemp = 72;
function adjustTemp(delta) {
    currentTemp = Math.max(60, Math.min(85, currentTemp + delta));
    document.getElementById('tempDisplay').textContent = currentTemp + 'Â°';
}

// Iframe controls
function hideLoading(iframe) {
    const loading = iframe.previousElementSibling;
    if (loading && loading.classList.contains('loading')) {
        loading.style.display = 'none';
    }
}

function reloadIframe(iframeId) {
    const iframe = document.getElementById(iframeId);
    const loading = iframe.previousElementSibling;
    if (loading) loading.style.display = 'block';
    iframe.src = iframe.src;
}

function toggleFullscreen(iframeId) {
    const iframe = document.getElementById(iframeId);
    
    if (!iframe) return;
    
    // Try different fullscreen methods for better compatibility
    if (iframe.requestFullscreen) {
        iframe.requestFullscreen();
    } else if (iframe.webkitRequestFullscreen) { // Safari
        iframe.webkitRequestFullscreen();
    } else if (iframe.msRequestFullscreen) { // IE11
        iframe.msRequestFullscreen();
    } else if (iframe.mozRequestFullScreen) { // Firefox
        iframe.mozRequestFullScreen();
    } else {
        // Fallback: maximize the iframe container
        const container = iframe.parentElement;
        if (container.requestFullscreen) {
            container.requestFullscreen();
        } else {
            alert('Fullscreen not supported on this browser');
        }
    }
}

function openExternal(url) {
    window.open(url, '_blank');
}

// Add hover effects to buttons
document.querySelectorAll('button').forEach(btn => {
    btn.addEventListener('mouseenter', function() {
        if (!this.classList.contains('toggle')) {
            this.style.transform = 'scale(1.05)';
        }
    });
    btn.addEventListener('mouseleave', function() {
        if (!this.classList.contains('toggle')) {
            this.style.transform = 'scale(1)';
        }
    });
});

// Prevent iframe from capturing all touch events on mobile
document.querySelectorAll('iframe').forEach(iframe => {
    iframe.addEventListener('load', function() {
        console.log('Iframe loaded:', iframe.id);
    });
});
</script>

</body>
</html>
